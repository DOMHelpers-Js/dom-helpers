<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Demo: .toArray()</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: sans-serif; background: #f0f2f5; padding: 24px; }
    h1 { font-size: 22px; margin-bottom: 4px; color: #1a1a2e; }
    .subtitle { font-size: 14px; color: #555; margin-bottom: 24px; }
    h2 { font-size: 14px; font-weight: 700; color: #888; text-transform: uppercase; letter-spacing: .6px; margin-bottom: 10px; margin-top: 24px; }

    .collection { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 20px; }
    .card {
      width: 120px; padding: 18px 10px; border-radius: 10px;
      background: #fff; border: 2px solid #dde1e7;
      text-align: center; font-size: 13px; font-weight: 600; color: #555;
      transition: all .3s;
    }
    .card .sub { display: block; font-size: 10px; color: #aaa; font-weight: 400; margin-top: 4px; font-family: monospace; }

    /* highlight on array access */
    .card.highlighted { border-color: #0891b2; background: #ecfeff; color: #164e63; transform: translateY(-4px); box-shadow: 0 6px 16px rgba(8,145,178,.18); }

    .controls { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; background: #fff; padding: 12px 16px; border-radius: 10px; border: 1px solid #e2e8f0; margin-bottom: 14px; }
    .btn { padding: 7px 16px; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; color: #fff; }
    .btn-run { background: #0891b2; } .btn-run:hover { background: #0e7490; }
    .btn-reset { background: #6b7280; } .btn-reset:hover { background: #4b5563; }

    /* output panel */
    .output-panel {
      background: #1e293b; color: #94a3b8; font-family: monospace; font-size: 13px;
      padding: 16px; border-radius: 10px; margin-bottom: 20px; line-height: 1.8;
    }
    .output-panel .line { display: block; }
    .output-panel .val { color: #67e8f9; }
    .output-panel .label { color: #64748b; }

    /* what-you-can-do section */
    .capability-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 20px; }
    .cap-card {
      background: #fff; border-radius: 10px; padding: 14px;
      border: 1.5px solid #e2e8f0; font-size: 13px; color: #444;
    }
    .cap-card code { background: #f1f5f9; padding: 1px 5px; border-radius: 4px; font-size: 12px; }
    .cap-card .cap-result { margin-top: 8px; font-weight: 700; color: #0891b2; font-family: monospace; }

    .results { display: flex; flex-direction: column; gap: 8px; }
    .result-row { display: flex; align-items: center; gap: 10px; background: #fff; border-radius: 8px; padding: 10px 14px; border-left: 4px solid #ccc; font-size: 14px; color: #333; }
    .result-row.pass { border-left-color: #16a34a; }
    .result-row.fail { border-left-color: #dc2626; background: #fff5f5; }
    .badge { font-size: 11px; font-weight: 700; padding: 2px 8px; border-radius: 99px; flex-shrink: 0; }
    .pass .badge { background: #dcfce7; color: #15803d; }
    .fail .badge { background: #fee2e2; color: #b91c1c; }
  </style>
</head>
<body>
  <h1>Demo — <code>.toArray()</code></h1>
  <p class="subtitle">Converts a live <code>HTMLCollection</code> into a plain JavaScript <code>Array</code>, unlocking all native array methods.</p>

  <h2>The collection</h2>
  <div class="collection" id="col">
    <div class="card item" id="i1" data-price="10">Apple<span class="sub">data-price="10"</span></div>
    <div class="card item" id="i2" data-price="25">Banana<span class="sub">data-price="25"</span></div>
    <div class="card item" id="i3" data-price="15">Cherry<span class="sub">data-price="15"</span></div>
    <div class="card item" id="i4" data-price="40">Durian<span class="sub">data-price="40"</span></div>
  </div>

  <h2>Run conversion & inspect</h2>
  <div class="controls">
    <button class="btn btn-run"   onclick="runToArray()">Run .toArray()</button>
    <button class="btn btn-reset" onclick="resetCards()">Reset</button>
  </div>
  <div class="output-panel" id="output">
    <span class="line label">// click "Run .toArray()" to see output</span>
  </div>

  <h2>What you can do with the array (live results)</h2>
  <div class="capability-grid" id="capabilities"></div>

  <h2>Automated test results</h2>
  <div class="results" id="results"></div>

 <script src="../../src/01_core/01_dh-core.js"></script>
 
 <script>
    const output  = document.getElementById('output');
    const capGrid = document.getElementById('capabilities');
    const resultsEl = document.getElementById('results');

    function addResult(pass, label, detail) {
      const row = document.createElement('div');
      row.className = 'result-row ' + (pass ? 'pass' : 'fail');
      row.innerHTML = '<span class="badge">' + (pass ? 'PASS' : 'FAIL') + '</span><strong>' + label + '</strong>' + (detail ? ' — <span style="color:#666">' + detail + '</span>' : '');
      resultsEl.appendChild(row);
    }

    function capCard(title, code, result) {
      const d = document.createElement('div');
      d.className = 'cap-card';
      d.innerHTML = '<div style="font-size:11px;color:#888;text-transform:uppercase;font-weight:700;margin-bottom:6px;">' + title + '</div>' +
        '<code>' + code + '</code>' +
        '<div class="cap-result">' + result + '</div>';
      capGrid.appendChild(d);
    }

    function runToArray() {
      const col = Collections.ClassName('item');
      const arr = col.toArray();

      // Highlight all cards sequentially
      Collections.ClassName('item').forEach(el => el.classList.remove('highlighted'));
      arr.forEach((el, i) => setTimeout(() => el.classList.add('highlighted'), i * 120));

      output.innerHTML =
        '<span class="line"><span class="label">typeof collection: </span><span class="val">' + typeof col + '</span></span>' +
        '<span class="line"><span class="label">Array.isArray(collection): </span><span class="val">' + Array.isArray(col) + '</span></span>' +
        '<span class="line"><span class="label">Array.isArray(arr): </span><span class="val">' + Array.isArray(arr) + '</span></span>' +
        '<span class="line"><span class="label">arr.length: </span><span class="val">' + arr.length + '</span></span>' +
        '<span class="line"><span class="label">arr[0].id: </span><span class="val">"' + arr[0].id + '"</span></span>' +
        '<span class="line"><span class="label">arr[arr.length-1].id: </span><span class="val">"' + arr[arr.length-1].id + '"</span></span>';

      // Build capability cards
      capGrid.innerHTML = '';
      capCard('slice(1,3)',   'arr.slice(1,3)',   arr.slice(1,3).map(e=>e.id).join(', '));
      capCard('reverse()',    'arr.reverse()',    [...arr].reverse().map(e=>e.id).join(', '));
      capCard('map ids',      'arr.map(e=>e.id)', arr.map(e=>e.id).join(', '));
      const prices = arr.map(e=>+e.dataset.price);
      capCard('prices',       'dataset.price[]',  prices.join(', '));
      capCard('sort by price','arr.sort(price)',  [...arr].sort((a,b)=>+a.dataset.price - +b.dataset.price).map(e=>e.id).join(', '));
      capCard('reduce sum',   'reduce prices',    prices.reduce((s,p)=>s+p,0) + ' total');
      capCard('spread [...arr]', '[...arr].length', [...arr].length + ' elements');
      capCard('indexOf',      'arr.indexOf(arr[2])', arr.indexOf(arr[2]));
    }

    function resetCards() {
      Collections.ClassName('item').forEach(el => el.classList.remove('highlighted'));
      output.innerHTML = '<span class="line label">// click "Run .toArray()" to see output</span>';
      capGrid.innerHTML = '';
    }

    // ── Automated tests ───────────────────────────────────────────────────
    const col = Collections.ClassName('item');
    const arr = col.toArray();

    addResult(Array.isArray(arr),              '.toArray() returns a true JS Array',           'Array.isArray → ' + Array.isArray(arr));
    addResult(!Array.isArray(col),             'original collection is NOT a plain Array',     'Array.isArray(collection) → ' + Array.isArray(col));
    addResult(arr.length === 4,                '.toArray() length matches collection.length',  arr.length + ' === ' + col.length);
    addResult(arr[0] === col[0],               'arr[0] === collection[0] (same element refs)', '');
    addResult(arr[arr.length-1] === col[col.length-1], 'last element reference matches', '');
    addResult(typeof arr.slice === 'function', 'array has .slice() (native Array method)',     '');
    addResult(typeof arr.sort  === 'function', 'array has .sort()  (native Array method)',     '');
    addResult(typeof arr.indexOf === 'function','array has .indexOf() (native Array method)',  '');
  </script>
</body>
</html>
