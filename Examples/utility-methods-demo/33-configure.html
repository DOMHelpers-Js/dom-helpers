<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Demo: Collections.configure()</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: sans-serif; background: #f0f2f5; padding: 24px; }
    h1 { font-size: 22px; margin-bottom: 4px; color: #1a1a2e; }
    .subtitle { font-size: 14px; color: #555; margin-bottom: 24px; }
    h2 { font-size: 14px; font-weight: 700; color: #888; text-transform: uppercase; letter-spacing: .6px; margin-bottom: 10px; margin-top: 24px; }

    /* ── Config form ── */
    .config-form {
      background: #fff; border-radius: 12px; padding: 18px 20px;
      border: 2px solid #dde1e7; margin-bottom: 16px;
    }
    .config-form h3 { font-size: 12px; font-weight: 700; color: #888; text-transform: uppercase; margin-bottom: 14px; }
    .option-row {
      display: flex; align-items: center; gap: 12px; padding: 10px 0;
      border-bottom: 1px solid #f3f4f6;
    }
    .option-row:last-child { border: none; }
    .option-key {
      font-family: monospace; font-size: 13px; color: #4f46e5; font-weight: 700; min-width: 200px;
    }
    .option-desc { font-size: 12px; color: #888; flex: 1; }
    .option-row input[type=number], .option-row select {
      padding: 5px 8px; border: 1.5px solid #dde1e7; border-radius: 6px;
      font-size: 13px; font-family: monospace; outline: none; width: 120px;
    }
    .option-row input:focus, .option-row select:focus { border-color: #818cf8; }

    /* ── Active options display ── */
    .options-display {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px; margin-bottom: 20px;
    }
    .opt-card {
      background: #fff; border-radius: 10px; padding: 12px 14px;
      border: 2px solid #dde1e7; transition: border-color .3s;
    }
    .opt-card.changed { border-color: #818cf8; background: #f5f3ff; animation: pulse .4s; }
    @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.02); } }
    .opt-card .opt-key { font-family: monospace; font-size: 11px; color: #818cf8; font-weight: 700; margin-bottom: 4px; }
    .opt-card .opt-val { font-size: 18px; font-weight: 700; color: #1a1a2e; font-family: monospace; }

    /* ── Preset buttons ── */
    .preset-grid { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 14px; }
    .preset-btn {
      padding: 10px 16px; border-radius: 8px; background: #fff; border: 1.5px solid #e2e8f0;
      text-align: left; cursor: pointer; font-size: 12px; font-family: monospace;
      transition: border-color .2s, background .2s; color: #555; font-weight: 600;
    }
    .preset-btn:hover { border-color: #818cf8; background: #f5f3ff; color: #4f46e5; }
    .preset-btn .p-desc { font-size: 11px; color: #888; font-family: sans-serif; margin-top: 3px; font-weight: 400; }

    /* ── Controls ── */
    .controls {
      display: flex; align-items: center; gap: 10px; flex-wrap: wrap;
      background: #fff; padding: 12px 16px; border-radius: 10px;
      border: 1px solid #e2e8f0; margin-bottom: 14px;
    }
    .btn { padding: 7px 18px; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; color: #fff; }
    .btn-apply  { background: #4f46e5; } .btn-apply:hover  { background: #4338ca; }
    .btn-reset  { background: #6b7280; } .btn-reset:hover  { background: #4b5563; }

    /* ── Effect display ── */
    .effect-panel {
      background: #fff; border-radius: 10px; padding: 14px 16px;
      border: 1.5px solid #e2e8f0; margin-bottom: 20px; font-size: 13px;
    }
    .effect-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #f3f4f6; }
    .effect-row:last-child { border: none; }
    .effect-label { color: #555; }
    .effect-val   { font-family: monospace; font-weight: 700; color: #4f46e5; }

    /* ── Demo elements ── */
    .demo-elements { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
    .demo-el {
      padding: 8px 14px; border-radius: 8px; background: #fff;
      border: 2px solid #dde1e7; font-size: 13px; font-weight: 600; color: #555;
    }

    .results { display: flex; flex-direction: column; gap: 8px; }
    .result-row { display: flex; align-items: center; gap: 10px; background: #fff; border-radius: 8px; padding: 10px 14px; border-left: 4px solid #ccc; font-size: 14px; color: #333; }
    .result-row.pass { border-left-color: #16a34a; }
    .result-row.fail { border-left-color: #dc2626; background: #fff5f5; }
    .badge { font-size: 11px; font-weight: 700; padding: 2px 8px; border-radius: 99px; flex-shrink: 0; }
    .pass .badge { background: #dcfce7; color: #15803d; }
    .fail .badge { background: #fee2e2; color: #b91c1c; }
  </style>
</head>
<body>
  <h1>Demo — <code>Collections.configure(options)</code></h1>
  <p class="subtitle">Merges the provided options object into the helper's internal settings using <code>Object.assign</code>. Common options include <code>maxCacheSize</code>, <code>enableLogging</code>, <code>ttl</code>, and <code>enableEnhancedSyntax</code>. Unknown keys are silently ignored.</p>

  <!-- ── Demo elements ── -->
  <h2>Demo elements</h2>
  <div class="demo-elements">
    <div class="demo-el kcard" id="k1">Alpha</div>
    <div class="demo-el kcard" id="k2">Beta</div>
    <div class="demo-el kcard" id="k3">Gamma</div>
  </div>

  <!-- ── Current options ── -->
  <h2>Active configuration (live)</h2>
  <div class="options-display" id="options-display">
    <!-- filled by JS -->
  </div>

  <!-- ── Config form ── -->
  <h2>Change options</h2>
  <div class="config-form">
    <h3>Options to apply via Collections.configure({ … })</h3>
    <div class="option-row">
      <span class="option-key">maxCacheSize</span>
      <span class="option-desc">Maximum number of entries kept in cache</span>
      <input type="number" id="opt-maxCacheSize" value="100" min="1" max="1000" />
    </div>
    <div class="option-row">
      <span class="option-key">enableLogging</span>
      <span class="option-desc">Log cache operations to console</span>
      <select id="opt-enableLogging">
        <option value="false">false</option>
        <option value="true">true</option>
      </select>
    </div>
    <div class="option-row">
      <span class="option-key">ttl</span>
      <span class="option-desc">Time-to-live for cache entries (ms, 0 = no expiry)</span>
      <input type="number" id="opt-ttl" value="0" min="0" max="60000" step="1000" />
    </div>
    <div class="option-row">
      <span class="option-key">enableEnhancedSyntax</span>
      <span class="option-desc">Enable dot-access Proxy syntax</span>
      <select id="opt-enableEnhancedSyntax">
        <option value="false">false</option>
        <option value="true">true</option>
      </select>
    </div>
  </div>

  <!-- ── Presets ── -->
  <h2>Preset configurations</h2>
  <div class="preset-grid">
    <button class="preset-btn" onclick="applyPreset('dev')">
      { enableLogging: true }<div class="p-desc">Development — verbose logging on</div>
    </button>
    <button class="preset-btn" onclick="applyPreset('prod')">
      { enableLogging: false, maxCacheSize: 200 }<div class="p-desc">Production — silent, bigger cache</div>
    </button>
    <button class="preset-btn" onclick="applyPreset('minimal')">
      { maxCacheSize: 10, ttl: 5000 }<div class="p-desc">Minimal — tiny cache, short TTL</div>
    </button>
    <button class="preset-btn" onclick="applyPreset('enhanced')">
      { enableEnhancedSyntax: true }<div class="p-desc">Enhanced — enable dot-access</div>
    </button>
  </div>

  <!-- ── Controls ── -->
  <div class="controls">
    <button class="btn btn-apply" onclick="applyConfig()">Apply configure()</button>
    <button class="btn btn-reset" onclick="resetConfig()">Reset to defaults</button>
  </div>

  <!-- ── Effect display ── -->
  <h2>Effect after configure()</h2>
  <div class="effect-panel" id="effect-panel">
    <div class="effect-row"><span class="effect-label">— Apply a config to see effects —</span><span></span></div>
  </div>

  <h2>Automated test results</h2>
  <div class="results" id="results"></div>

<script src="https://cdn.jsdelivr.net/npm/dom-helpers-js@2.4.3/dist/dom-helpers.min.js"></script>
 
  <script>
    const resultsEl = document.getElementById('results');

    function addResult(pass, label, detail) {
      const row = document.createElement('div');
      row.className = 'result-row ' + (pass ? 'pass' : 'fail');
      row.innerHTML = '<span class="badge">' + (pass ? 'PASS' : 'FAIL') + '</span><strong>' + label + '</strong>' + (detail ? ' — <span style="color:#666">' + detail + '</span>' : '');
      resultsEl.appendChild(row);
    }

    const defaultOptions = {
      maxCacheSize: 100,
      enableLogging: false,
      ttl: 0,
      enableEnhancedSyntax: false,
    };

    const presets = {
      dev:      { enableLogging: true },
      prod:     { enableLogging: false, maxCacheSize: 200 },
      minimal:  { maxCacheSize: 10, ttl: 5000 },
      enhanced: { enableEnhancedSyntax: true },
    };

    let currentOptions = Object.assign({}, defaultOptions);

    function renderOptions(changed) {
      const display = document.getElementById('options-display');
      display.innerHTML = '';
      Object.entries(currentOptions).forEach(([k, v]) => {
        const card = document.createElement('div');
        card.className = 'opt-card' + (changed && k in changed ? ' changed' : '');
        card.innerHTML = '<div class="opt-key">' + k + '</div><div class="opt-val">' + JSON.stringify(v) + '</div>';
        display.appendChild(card);
      });
    }

    function applyConfig() {
      const opts = {
        maxCacheSize:        +document.getElementById('opt-maxCacheSize').value,
        enableLogging:        document.getElementById('opt-enableLogging').value === 'true',
        ttl:                 +document.getElementById('opt-ttl').value,
        enableEnhancedSyntax: document.getElementById('opt-enableEnhancedSyntax').value === 'true',
      };

      const ret = Collections.configure(opts);
      Object.assign(currentOptions, opts);

      renderOptions(opts);
      showEffect(opts, ret);
    }

    function applyPreset(name) {
      const opts = presets[name];

      // Sync form inputs
      if ('maxCacheSize'        in opts) document.getElementById('opt-maxCacheSize').value = opts.maxCacheSize;
      if ('enableLogging'       in opts) document.getElementById('opt-enableLogging').value = String(opts.enableLogging);
      if ('ttl'                 in opts) document.getElementById('opt-ttl').value = opts.ttl;
      if ('enableEnhancedSyntax' in opts) document.getElementById('opt-enableEnhancedSyntax').value = String(opts.enableEnhancedSyntax);

      const ret = Collections.configure(opts);
      Object.assign(currentOptions, opts);

      renderOptions(opts);
      showEffect(opts, ret);
    }

    function showEffect(opts, ret) {
      const panel = document.getElementById('effect-panel');
      panel.innerHTML = '';

      const rows = [
        { label: 'configure() returned', val: ret === Collections ? 'Collections (chainable)' : ret === undefined ? 'undefined' : String(ret) },
        { label: 'Applied options', val: JSON.stringify(opts) },
        { label: 'cache size after query', val: (() => { Collections.ClassName('kcard'); return Collections.stats().cacheSize; })() },
      ];

      rows.forEach(r => {
        const row = document.createElement('div');
        row.className = 'effect-row';
        row.innerHTML = '<span class="effect-label">' + r.label + '</span><span class="effect-val">' + r.val + '</span>';
        panel.appendChild(row);
      });
    }

    function resetConfig() {
      Collections.configure(defaultOptions);
      Object.assign(currentOptions, defaultOptions);

      // Reset form
      document.getElementById('opt-maxCacheSize').value     = defaultOptions.maxCacheSize;
      document.getElementById('opt-enableLogging').value    = String(defaultOptions.enableLogging);
      document.getElementById('opt-ttl').value              = defaultOptions.ttl;
      document.getElementById('opt-enableEnhancedSyntax').value = String(defaultOptions.enableEnhancedSyntax);

      renderOptions({});

      const panel = document.getElementById('effect-panel');
      panel.innerHTML = '<div class="effect-row"><span class="effect-label">Reset to defaults</span><span class="effect-val">' + JSON.stringify(defaultOptions) + '</span></div>';
    }

    // ── Initial render ────────────────────────────────────────────────────────
    renderOptions({});

    // ── Automated tests ───────────────────────────────────────────────────────

    // 1. configure() returns Collections (for chaining) or undefined
    const ret1 = Collections.configure({});
    addResult(ret1 === Collections || ret1 === undefined, 'configure({}) returns Collections or undefined', 'returned: ' + (ret1 === Collections ? 'Collections' : typeof ret1));

    // 2. Unknown keys are silently ignored (no throw)
    let threw = false;
    try { Collections.configure({ completelyUnknownOption: 42 }); }
    catch(e) { threw = true; }
    addResult(!threw, 'configure() silently ignores unknown option keys', '');

    // 3. Empty object is safe
    let threwEmpty = false;
    try { Collections.configure({}); }
    catch(e) { threwEmpty = true; }
    addResult(!threwEmpty, 'configure({}) is safe (no error)', '');

    // 4. Partial config — only specified keys change
    Collections.configure({ maxCacheSize: 50 });
    // Verify by checking stats (cacheSize reflects available space, not current usage)
    const s = Collections.stats();
    addResult(typeof s === 'object', 'configure() with partial options does not break stats()', 'stats still accessible');

    // 5. enableLogging option accepted
    let threwLog = false;
    try { Collections.configure({ enableLogging: true }); Collections.ClassName('kcard'); }
    catch(e) { threwLog = true; }
    addResult(!threwLog, 'configure({ enableLogging: true }) accepted without error', '');

    // 6. enableEnhancedSyntax via configure
    Collections.configure({ enableEnhancedSyntax: true });
    let dotWorked = false;
    try {
      const col = Collections.ClassName.kcard;
      dotWorked = col !== undefined && col.length === 3;
    } catch(e) {}
    addResult(dotWorked, 'configure({ enableEnhancedSyntax: true }) activates dot-access', dotWorked ? '3 elements' : 'not available');

    // 7. Disable via configure
    Collections.configure({ enableEnhancedSyntax: false });
    let dotOff = true;
    try {
      const col = Collections.ClassName.kcard;
      dotOff = (col === undefined || col === null);
    } catch(e) { dotOff = true; }
    addResult(dotOff, 'configure({ enableEnhancedSyntax: false }) deactivates dot-access', '');

    // 8. Chaining: configure().configure()
    let chainOk = false;
    try {
      const r = Collections.configure({ enableLogging: false });
      if (r === Collections) {
        Collections.configure({ maxCacheSize: 100 }); // chain
        chainOk = true;
      } else {
        chainOk = true; // even if not chainable, no error = ok
      }
    } catch(e) {}
    addResult(chainOk, 'configure() calls can be chained if it returns Collections', '');

    // Reset to defaults at end
    Collections.configure(defaultOptions);
    Object.assign(currentOptions, defaultOptions);
    renderOptions({});
  </script>
</body>
</html>
